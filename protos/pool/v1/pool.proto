syntax = "proto3";

package pool.v1; 
option go_package = "github.com/fox-one/pando-protos/pool/v1;pool";

import "common/v1/common.proto";

service PoolService {
  rpc ListAssets(ListAssetsRequest) returns (ListAssetsResponse);
  rpc ListEarningProducts(ListEarningProductsRequest) returns (ListEarningProductsResponse);
  rpc GetEarningProduct(GetEarningProductRequest) returns (GetEarningProductResponse);

  rpc ListMyEarningProducts(ListMyEarningProductsRequest) returns (ListMyEarningProductsResponse);
  rpc GetMyEarningProduct(GetMyEarningProductRequest) returns (GetMyEarningProductResponse);

  rpc GetOrder(GetOrderRequest) returns (GetOrderResponse);
}


enum EarningAction {
  NOT_SET = 0;
  BUY = 1;
  REDEEM = 2;
  DEPOSIT = 3;
}

message EarningSnapshotBuyData {
  int64 product_id = 1;
  string follow_id = 2;
}

message EarningSnapshotRedeemData {
  int64 earning_id = 1;
  string amount = 2;
  string follow_id = 3;
}

message EarningSnapshotData {
  EarningAction action = 1;
  EarningSnapshotBuyData buy_data = 2;
  EarningSnapshotRedeemData redeem_data = 3;
}

message ListAssetsRequest {}

message ListAssetsResponse {
  repeated common.v1.Asset assets = 1;
}

message EarningProduct {
  int64 id = 1;
  string account_id = 2;
  string name = 3;
  string description = 4;
  string asset_id = 5;
  string interest_rate =6;
  int64 period = 7;
  string min_amount_per_order = 8;
  string max_amount_per_order = 9;
  string sold = 10;
  string redeemed = 11;
  string capacity = 12;
  string normalized_amount = 13;
  string borrow_rate = 14;
  int64 borrow_rate_circle = 15;
  int64 redemption_period = 16;
  int64 version = 17;
  int32 borrow_rate_updated_at = 18;
  int32 created_at = 19;
}

message ListEarningProductsRequest {}

message ListEarningProductsResponse {
  repeated EarningProduct products = 1;
}

message GetEarningProductRequest {
  int64 id = 1;
}

message GetEarningProductResponse {
  EarningProduct product = 1;
}

message UserEarningProduct {
  enum Status {
    NOT_SET = 0;
    ACTIVE = 1;
    INACTIVE = 2;
  }
  int64 id = 1;
  string user_id = 2;
  int64 earning_product_id = 3;
  Status status = 4;
  string normalized_amount = 5;
  string total_buy_amount = 6;
  string total_redeem_amount = 7;
  int64 version = 8;
  int32 created_at = 9;
  int32 updated_at = 10;
}

message ListMyEarningProductsRequest {}

message ListMyEarningProductsResponse {
  repeated UserEarningProduct products = 1;
}

message GetMyEarningProductRequest {
  int64 id = 1;
}

message GetMyEarningProductResponse {
  UserEarningProduct product = 1;
}

message GetOrderRequest {
  string follow_id = 1;
}

message Event {
  enum Status {
    NOT_SET = 0;
    INIT = 1;
    USED = 2;
  }
  int64 id = 1;
  string user_id = 2;
  EarningAction action = 3;
  int64 product_id = 4;
  string asset_id = 5;
  string amount = 6;
  string extra = 7;
  Status status = 8;
  string follow_id = 9;
  int32 created_at = 10;
}

message Order {
  enum Status {
    NOT_SET = 0;
    PROCESSING = 1;
    DONE = 2;
    CANCELED = 3;
    CLOSED = 4;
  }
  string follow_id = 1;
  Status status = 2;
  Event event = 3;
  UserEarningProduct uep = 4;
}

message GetOrderResponse {
  Order order = 1;
}
